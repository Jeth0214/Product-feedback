import{a as _}from"./chunk-W4RJ5YNC.js";import{c as O,l as D,u as L}from"./chunk-HRO62DS5.js";import{Ab as S,Ib as x,K as v,L as f,O as u,Pa as y,U as o,Wb as g,_ as k,_a as F,a,cb as B,fa as p,g as h,ib as m,n as b,nb as I,oa as i,rb as C,sb as w,z as d}from"./chunk-ZODXZFG3.js";function l(n){n||(k(l),n=o(p));let e=new h(t=>n.onDestroy(t.next.bind(t)));return t=>t.pipe(v(e))}var c=class n{#e=i(!1);isLoading=this.#e.asReadonly();loadingOn(){this.#e.set(!0)}loadingOff(){this.#e.set(!1)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var E=class n{api="api/feedBacks";destroy$=o(p);_http=o(D);_toastrService=o(_);_router=o(L);_loadingService=o(c);feedBacks=i([]);selectedFeedBack=i({});categoryTerm=i("All");sortValue=i("Most Upvotes");isLoading=i(!1);filteredFeedBacks=g(()=>{let e=this.categoryTerm(),t=this.feedBacks(),r=this.sortValue(),s=this.filterFeedBacksByCategory(e,t);return this.sortFeedBacksByValue(r,s)});getAllFeedBacks(){this._loadingService.loadingOn(),this._http.get(this.api).pipe(f(e=>this.feedBacks.set(e)),d(this.handleError("Get All Feedbacks",[])),l(this.destroy$)).subscribe(e=>{this._loadingService.loadingOff()})}getFeedBackById(e){this._loadingService.loadingOn(),this._http.get(`${this.api}/${e}`).pipe(d(this.handleError("Get Feedback By id",{})),l(this.destroy$)).subscribe(t=>{this._loadingService.loadingOff(),this.selectedFeedBack.set(t)})}addFeedBack(e){return this._http.post(this.api,e)}updateFeedBack(e){return this._http.put(this.api,e).pipe(f(()=>{this.selectedFeedBack.set(a(a({},this.selectedFeedBack()),e))}),d(this.handleError("Update Feedback",{})))}upVoteFeedBack(e){this._http.put(this.api,e).pipe(d(this.handleError("Update Feedback",{})),l(this.destroy$)).subscribe(()=>{this.feedBacks.update(t=>t.map(r=>e.id===r.id?a(a({},r),e):r)),this.selectedFeedBack.set(e),this._toastrService.success("Feedback upvoted successfully","Success")})}deleteFeedBack(e){return this._http.delete(`${this.api}/${e}`)}handleError(e="operation",t){return r=>(this._toastrService.error(`${e} failed: ${r.body.error}`,`Status: ${r.status}`),b(t))}setCategoryTerm(e){this.categoryTerm.set(e)}setSortValue(e){this.sortValue.set(e)}getCommentsLength(e){return e.comments?e.comments.reduce((t,r)=>{let s=r.replies?r.replies.length:0;return t+1+s},0):0}filterFeedBacksByCategory(e,t){return e==="All"?t:t.filter(r=>r.category.toLowerCase()===e.toLowerCase())}sortFeedBacksByValue(e,t){switch(e){case"Most Upvotes":return t.sort((r,s)=>s.upvotes-r.upvotes);case"Least Upvotes":return t.sort((r,s)=>r.upvotes-s.upvotes);case"Most Comments":return t.sort((r,s)=>this.getCommentsLength(s)-this.getCommentsLength(r));case"Least Comments":return t.sort((r,s)=>this.getCommentsLength(r)-this.getCommentsLength(s));default:return t}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};function R(n,e){if(n&1&&(C(0,"div",0)(1,"div")(2,"div",1)(3,"span",2),x(4,"Loading..."),w()()()()),n&2){let t=S();m("ngClass",t.full?"p-6 my-5 h-screen grid place-items-center text-center":""),y(2),m("ngClass",t.full?"h-10 w-10 border-4":"h-3 w-3 border-2")}}var T=class n{_loadingService=o(c);isLoading=this._loadingService.isLoading;full=!1;static \u0275fac=function(t){return new(t||n)};static \u0275cmp=F({type:n,selectors:[["app-loading"]],inputs:{full:"full"},decls:1,vars:1,consts:[[3,"ngClass"],["role","status",1,"inline-block","animate-spin","rounded-full","border-solid","border-current","border-e-transparent","align-[-0.125em]","text-surface","motion-reduce:animate-[spin_1.5s_linear_infinite]",3,"ngClass"],[1,"!absolute","!-m-px","!h-px","!w-px","!overflow-hidden","!whitespace-nowrap","!border-0","!p-0","![clip:rect(0,0,0,0)]"]],template:function(t,r){t&1&&B(0,R,5,2,"div",0),t&2&&I(r.isLoading()?0:-1)},dependencies:[O],encapsulation:2})};export{l as a,c as b,E as c,T as d};
