import{a as ne,b as oe}from"./chunk-I4ADOBME.js";import{a as me,b as V,c as re,d as ae,e as le,f as se,g as ce,h as pe,i as de,j as ue}from"./chunk-ZOQ63MJE.js";import{f as te}from"./chunk-W5ZL4B5K.js";import{a as X,b as ee,c as E,d as ie}from"./chunk-RHYP4C7L.js";import{a as B}from"./chunk-W4RJ5YNC.js";import{c as T,d as W,s as Z,u as H,v as Q}from"./chunk-HRO62DS5.js";import"./chunk-W4BNGQYG.js";import{Ab as c,D as R,Db as J,Ib as s,Jb as K,Kb as h,La as O,O as q,Ob as Y,Pa as m,U as f,Wb as S,_a as x,aa as y,ba as b,cb as d,fa as z,ib as p,la as w,ma as _,nb as u,oa as $,pb as M,qb as A,rb as i,sb as a,tb as C,wb as F,zb as g}from"./chunk-ZODXZFG3.js";var fe="user",D=class t{#e=$(null);user=this.#e.asReadonly();constructor(){this.loadUserFromStorage()}loadUserFromStorage(){let o=localStorage.getItem(fe);if(o){let e=JSON.parse(o);this.#e.set(e)}else{let e={image:"./assets/user-images/image-zena.jpg",name:"Zena Kelley",username:"velvetround"};localStorage.setItem(fe,JSON.stringify(e)),this.#e.set(e)}}static \u0275fac=function(e){return new(e||t)};static \u0275prov=q({token:t,factory:t.\u0275fac,providedIn:"root"})};function _e(t,o){t&1&&(i(0,"h2",1),s(1,"Add Comment"),a())}function ge(t,o){t&1&&(i(0,"div"),s(1,"Comment is required."),a())}function he(t,o){if(t&1&&(i(0,"div"),s(1),a()),t&2){let e=c(2);m(),h("Comment cannot exceed ",e.maxCharacters," characters.")}}function ve(t,o){if(t&1&&(i(0,"div",5),d(1,ge,2,0,"div")(2,he,2,1,"div"),a()),t&2){let e,n,r=c();m(),u(!((e=r.commentForm.get("comment"))==null||e.errors==null)&&e.errors.required?1:-1),m(),u(!((n=r.commentForm.get("comment"))==null||n.errors==null)&&n.errors.maxlength?2:-1)}}function xe(t,o){if(t&1&&(i(0,"p"),s(1),a()),t&2){let e=c();m(),h("",e.remainingCharacters," Characters left")}}var k=class t{_fb=f(de);destroyRef$=f(z);maxCharacters=250;remainingCharacters=this.maxCharacters;isReply=_.required();isCommenting=_.required();buttonText=S(()=>this.isReply()?"Reply":"Comment");commentContent=w();commentForm=new le({});ngOnInit(){this.commentForm=this._fb.group({comment:["",[V.required,V.maxLength(this.maxCharacters)]]}),this.commentForm.get("comment")?.valueChanges.pipe(X(this.destroyRef$)).subscribe(o=>{let e=o?.length||0;this.remainingCharacters=Math.max(0,this.maxCharacters-e)})}onSubmit(){if(this.commentForm.invalid)return;let o=this.commentForm.value.comment.trim();this.commentContent.emit(o),this.commentForm.reset(),this.remainingCharacters=250}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=x({type:t,selectors:[["app-comment-form"]],inputs:{isReply:[1,"isReply"],isCommenting:[1,"isCommenting"]},outputs:{commentContent:"commentContent"},decls:11,vars:9,consts:[[3,"ngClass"],[1,"font-bold","text-lg","text-dark-800","mb-6"],[3,"ngSubmit","formGroup","ngClass"],[1,"mb-4","flex-1"],["formControlName","comment","placeholder","Type your comment here",1,"min-h-10","w-full","resize-none","rounded","bg-light-500","placeholder:text-dark-500","text-dark-800","text-sm","p-4","px-6","focus:border-blue",3,"ngClass"],[1,"text-red","text-sm"],[1,"flex","justify-between","items-center"],["type","submit",1,"flex","items-center","gap-1","bg-purple","rounded-10","font-bold","text-sm","text-light-500","py-3","px-6","hover:bg-purple-500","transition-colors","ease-in-out",3,"disabled"]],template:function(e,n){if(e&1&&(i(0,"section",0),d(1,_e,2,0,"h2",1),i(2,"form",2),g("ngSubmit",function(){return n.onSubmit()}),i(3,"div",3),C(4,"textarea",4),d(5,ve,3,2,"div",5),a(),i(6,"div",6),d(7,xe,2,1,"p"),i(8,"button",7)(9,"span"),s(10),a()()()()()),e&2){let r,l;p("ngClass",n.isReply()?"":"shadow-sm bg-white rounded-lg p-6 my-6"),m(),u(n.isReply()?-1:1),m(),p("formGroup",n.commentForm)("ngClass",n.isReply()?"flex items-start gap-4":""),m(2),J("ngClass",(r=n.commentForm.get("comment"))!=null&&r.invalid&&((r=n.commentForm.get("comment"))!=null&&r.dirty||(r=n.commentForm.get("comment"))!=null&&r.touched)?"border-red":"border-0"),m(),u((l=n.commentForm.get("comment"))!=null&&l.invalid&&((l=n.commentForm.get("comment"))!=null&&l.dirty||(l=n.commentForm.get("comment"))!=null&&l.touched)?5:-1),m(2),u(n.isReply()?-1:7),m(),p("disabled",n.isCommenting()),m(2),h(" Post ",n.buttonText(),"")}},dependencies:[ue,se,me,re,ae,ce,pe,T],encapsulation:2})};function ye(t,o){if(t&1&&(i(0,"span",9),s(1),a()),t&2){let e,n=c();m(),h("@",(e=n.comment())==null?null:e.replyingTo,"")}}function be(t,o){if(t&1){let e=F();i(0,"div",8)(1,"app-comment-form",10),g("commentContent",function(r){y(e);let l=c();return b(l.onReply(r))}),a()()}if(t&2){let e=c();m(),p("isCommenting",e.isSendingReply)("isReply",!0)}}var N=class t{comment=_();commentId=_(0);isLastComment=_(!1);replyContent=w();isSendingReply=!1;showCommentForm=!1;onShowCommentForm(){this.showCommentForm=!this.showCommentForm}onReply(o){let e={commentId:this.commentId(),replyingTo:this.comment().user.username,content:o};this.replyContent.emit(e),this.showCommentForm=!1}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=x({type:t,selectors:[["app-comment"]],inputs:{comment:[1,"comment"],commentId:[1,"commentId"],isLastComment:[1,"isLastComment"]},outputs:{replyContent:"replyContent"},decls:16,vars:8,consts:[[1,"border-b","last:border-b-0","border-gray-200","last:pb-0"],[1,"flex","items-center","justify-between"],[1,"flex","gap-4"],[1,"h-10","w-10","rounded-full",3,"src","alt"],[1,"font-bold","text-dark-800"],[1,"font-semibold","text-blue","cursor-pointer","hover:underline","transition-all","ease-in-out",3,"click"],[1,"ps-0","md:ps-14","mt-3",3,"ngClass"],["class","text-purple font-bold",4,"ngIf"],[1,"ps-0","md:ps-14","mt-3"],[1,"text-purple","font-bold"],[3,"commentContent","isCommenting","isReply"]],template:function(e,n){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),C(3,"img",3),i(4,"div")(5,"h3",4),s(6),a(),i(7,"p"),s(8),a()()(),i(9,"button",5),g("click",function(){return n.onShowCommentForm()}),s(10," Reply "),a()(),i(11,"div",6)(12,"p"),d(13,ye,2,1,"span",7),s(14),a()(),d(15,be,2,2,"div",8),a()),e&2){let r,l,v,I,G,P;m(3),p("src",(r=n.comment())==null||r.user==null?null:r.user.image,O)("alt",(l=n.comment())==null||l.user==null?null:l.user.name),m(3),K((v=n.comment())==null||v.user==null?null:v.user.name),m(2),h(" @",(I=n.comment())==null||I.user==null?null:I.user.username,""),m(3),p("ngClass",n.isLastComment()?"pb-0":"pb-8"),m(2),p("ngIf",(G=n.comment())==null?null:G.replyingTo),m(),h(" ",(P=n.comment())==null?null:P.content," "),m(),u(n.showCommentForm?15:-1)}},dependencies:[T,W,k],encapsulation:2})};var Fe=(t,o)=>o==null?null:o.id,Se=(t,o)=>o==null?null:o.user;function ke(t,o){if(t&1){let e=F();i(0,"div",5)(1,"app-comment",3),g("replyContent",function(r){y(e);let l=c(4);return b(l.onAddingReply(r))}),a()()}if(t&2){let e=o.$implicit,n=c(2).$implicit;m(),p("comment",e)("commentId",n.id)}}function Ie(t,o){if(t&1&&(i(0,"div",4),M(1,ke,2,2,"div",5,Se),a()),t&2){let e=c().$implicit;m(),A(e==null?null:e.replies)}}function Re(t,o){if(t&1){let e=F();i(0,"app-comment",3),g("replyContent",function(r){y(e);let l=c(2);return b(l.onAddingReply(r))}),a(),d(1,Ie,3,0,"div",4)}if(t&2){let e,n=o.$implicit;p("comment",n)("commentId",n.id),m(),u(((e=n==null||n.replies==null?null:n.replies.length)!==null&&e!==void 0?e:0)>0?1:-1)}}function we(t,o){if(t&1&&(i(0,"h2",2),s(1),a(),M(2,Re,2,3,null,null,Fe)),t&2){let e=c();m(),h("",e.commentsCount()," Comments"),m(),A(e.comments())}}function Te(t,o){t&1&&(i(0,"div",1),C(1,"img",6),i(2,"h3",7),s(3,"No Comment"),a()())}var U=class t{_toastrService=f(B);_feedBackService=f(E);currentUser=_({});feedBack=_.required();comments=S(()=>this.feedBack()?.comments);commentsCount=S(()=>ne(this.feedBack()?.comments));isSendingReply=!1;onAddingReply(o){let e=this.addReplyToComment(o),n=this.feedBack();!n||!e||(n.comments=[...e],this.onSendReply(n))}addReplyToComment(o){let e=[...this.feedBack().comments],n=e.find(r=>r.id===o.commentId);if(!n){console.warn("Comment Not Found");return}return n.replies??=[],n.replies.push({content:o.content,replyingTo:o.replyingTo,user:this.currentUser()}),e}onSendReply(o){this.isSendingReply=!0,this._feedBackService.updateFeedBack(o).pipe(R(()=>{this.isSendingReply=!1})).subscribe({next:()=>{this._toastrService.success("Reply successfully added!")},error:e=>{this._toastrService.error("Failed to add comment. Please try again later.")}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=x({type:t,selectors:[["app-comment-list"]],inputs:{currentUser:[1,"currentUser"],feedBack:[1,"feedBack"]},decls:3,vars:1,consts:[[1,"rounded","overflow-hidden","shadow-sm","bg-white","p-6"],[1,"my-10"],[1,"font-bold","text-lg","text-dark-800","mb-8"],[3,"replyContent","comment","commentId"],[1,"mt-8"],[1,"md:ms-6","ps-6"],["src","./assets/suggestions/illustration-empty.svg","alt","Man with magnifying glass",1,"mx-auto","mb-6"],[1,"font-bold","text-3xl","text-center"]],template:function(e,n){if(e&1&&(i(0,"section",0),d(1,we,4,1)(2,Te,4,0,"div",1),a()),e&2){let r;m(),u(n.comments()&&((r=n.comments())==null?null:r.length)>0?1:2)}},dependencies:[N],encapsulation:2})};var Be=t=>["/feedback-form",t];function Ee(t,o){t&1&&C(0,"app-loading",1),t&2&&p("full",!0)}function De(t,o){if(t&1&&(i(0,"a",5),s(1," Edit Feedback "),a()),t&2){let e=c(2);p("routerLink",Y(1,Be,e.feedBack().id))}}function Le(t,o){if(t&1){let e=F();C(0,"app-feedback-card",7)(1,"app-comment-list",8),i(2,"app-comment-form",9),g("commentContent",function(r){y(e);let l=c(2);return b(l.onCommentAdded(r))}),a()}if(t&2){let e=c(2);p("feedBack",e.feedBack()),m(),p("currentUser",e.currentUser())("feedBack",e.feedBack()),m(),p("isCommenting",e.isAddingComment)("isReply",!1)}}function Ne(t,o){t&1&&(i(0,"div",6)(1,"div"),C(2,"img",10),i(3,"h2",11),s(4," Feedback Not Found."),a(),i(5,"p",12),s(6," Got a suggestion? Found a bug that needs to be squashed? "),C(7,"br"),s(8," We love hearing about new ideas to improve our app. "),a()()())}function Ue(t,o){if(t&1&&(i(0,"section",2)(1,"a",3),C(2,"img",4),i(3,"span"),s(4,"Go Back"),a()(),d(5,De,2,3,"a",5),a(),d(6,Le,3,5)(7,Ne,9,0,"div",6)),t&2){let e=c();m(5),u(e.feedBack()?5:-1),m(),u(e.feedBack()?6:7)}}var Ce=class t{_activatedRoute=f(Z);_authService=f(D);_feedbackService=f(E);_router=f(H);_toastrService=f(B);_loadingService=f(ee);id=0;isLoading=!1;isAddingComment=!1;feedBack=this._feedbackService.selectedFeedBack;currentUser=this._authService.user;comments=S(()=>this.feedBack().comments?this.feedBack().comments:[]);constructor(){this.getFeedBack()}getFeedBack(){this._activatedRoute.paramMap.subscribe(o=>{let e=o.get("id");e&&(this.id=+e,this._feedbackService.getFeedBackById(this.id))})}onCommentAdded(o){this.isAddingComment=!0;let e=this.comments(),n=e&&e.length>0?e[e.length-1].id+1:1,r=this.currentUser();if(!r){this._toastrService.error("You must be logged in to comment.");return}let l={id:n,user:r,content:o},v=this.feedBack();v.comments||(v.comments=[]),v.comments.push(l),this._feedbackService.updateFeedBack(v).pipe(R(()=>{this.isAddingComment=!1})).subscribe({next:()=>{},error:I=>{this._toastrService.error("Failed to add comment. Please try again later.")}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=x({type:t,selectors:[["app-feedback-details"]],decls:3,vars:1,consts:[[1,"max-w-3xl","mx-auto","px-6","py-6","md:py-14","lg:py-20"],[3,"full"],[1,"flex","justify-between","items-center"],["routerLink","/",1,"text-sm","flex","items-center","gap-3","cursor-pointer","transition","hover:font-bold","hover:underline"],["loading","lazy","src","./assets/shared/icon-blue-arrow-left.svg","alt","arrow left"],[1,"bg-blue","text-white","px-6","py-3","rounded-xl","font-bold","hover:bg-blue-800","hover:text-light-500","transition","ease-in-out",3,"routerLink"],[1,"bg-white","rounded-lg","shadow-md","mx-6","md:mx-0","p-6","my-5","h-screen","grid","place-items-center","text-center"],[3,"feedBack"],[3,"currentUser","feedBack"],[3,"commentContent","isCommenting","isReply"],["src","./assets/suggestions/illustration-empty.svg","alt","Man with magnifying glass",1,"mx-auto","mb-12"],[1,"font-bold","text-2xl","mb-4"],[1,"mb-12"]],template:function(e,n){e&1&&(i(0,"div",0),d(1,Ee,1,1,"app-loading",1)(2,Ue,8,2),a()),e&2&&(m(),u(n._loadingService.isLoading()?1:2))},dependencies:[Q,te,ie,oe,k,U],encapsulation:2})};export{Ce as FeedbackDetailsComponent};
