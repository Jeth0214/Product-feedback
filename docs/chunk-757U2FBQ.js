import{a as me}from"./chunk-3MX7TEDJ.js";import{a as ne,b as oe}from"./chunk-FJAVHO3L.js";import{a as re,b as j,c as ae,d as le,e as se,f as ce,g as pe,h as de,i as ue,j as fe}from"./chunk-UX4HVCSM.js";import"./chunk-GGA2CEMS.js";import{a as Z,b as ee,c as E,d as ie}from"./chunk-KSXUJNXY.js";import{a as X,c as B,k as R}from"./chunk-X6QY3NVG.js";import{f as te,g as D}from"./chunk-3PTPIBSG.js";import{d as Q,e as I,f as W}from"./chunk-2OCL7C4P.js";import"./chunk-W4BNGQYG.js";import{Cb as J,D as S,Hb as c,Ib as T,Jb as y,Ka as Y,Oa as i,U as f,Ub as k,Vb as K,Za as h,aa as v,ba as b,bb as d,fa as H,hb as s,la as w,ma as _,mb as u,oa as O,ob as q,pb as G,qb as m,rb as r,sb as g,vb as x,yb as C,zb as l}from"./chunk-BJCTUVIL.js";function _e(t,o){t&1&&(m(0,"h2",1),c(1,"Add Comment"),r())}function ge(t,o){t&1&&(m(0,"div"),c(1,"Comment is required."),r())}function he(t,o){if(t&1&&(m(0,"div"),c(1),r()),t&2){let e=l(2);i(),y("Comment cannot exceed ",e.maxCharacters," characters.")}}function ve(t,o){if(t&1&&(m(0,"div",5),d(1,ge,2,0,"div")(2,he,2,1,"div"),r()),t&2){let e,n,a=l();i(),u(!((e=a.commentForm.get("comment"))==null||e.errors==null)&&e.errors.required?1:-1),i(),u(!((n=a.commentForm.get("comment"))==null||n.errors==null)&&n.errors.maxlength?2:-1)}}function be(t,o){if(t&1&&(m(0,"p"),c(1),r()),t&2){let e=l();i(),y("",e.remainingCharacters," Characters left")}}function xe(t,o){t&1&&c(0," Posting... ")}function ye(t,o){if(t&1&&(m(0,"span",8),c(1,"Post"),r(),m(2,"span"),c(3),r()),t&2){let e=l();i(3),T(e.buttonText())}}var F=class t{fb=f(ue);destroyRef$=f(H);maxCharacters=250;remainingCharacters=this.maxCharacters;isReply=_.required();isCommenting=_.required();buttonText=k(()=>this.isReply()?"Reply":"Comment");commentContent=w();commentForm=new se({});ngOnInit(){this.commentForm=this.fb.group({comment:["",[j.required,j.maxLength(this.maxCharacters)]]}),this.commentForm.get("comment")?.valueChanges.pipe(Z(this.destroyRef$)).subscribe(o=>{let e=o?.length||0;this.remainingCharacters=Math.max(0,this.maxCharacters-e)})}onSubmit(){if(this.commentForm.invalid)return;let o=this.commentForm.value.comment.trim();this.commentContent.emit(o),this.commentForm.reset(),this.remainingCharacters=250}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-comment-form"]],inputs:{isReply:[1,"isReply"],isCommenting:[1,"isCommenting"]},outputs:{commentContent:"commentContent"},decls:11,vars:9,consts:[[3,"ngClass"],[1,"font-bold","text-lg","text-dark-800","mb-6"],[3,"ngSubmit","formGroup","ngClass"],[1,"mb-4","flex-1"],["formControlName","comment","placeholder","Type your comment here",1,"min-h-10","w-full","resize-none","rounded","bg-light-500","placeholder:text-dark-500","text-dark-800","text-sm","p-4","px-6","focus:border-blue",3,"ngClass"],[1,"text-red","text-sm"],[1,"flex","justify-between","items-center"],["type","submit",1,"flex","items-center","gap-1","bg-purple","rounded-10","font-bold","text-sm","text-light-500","py-3","px-6","hover:bg-purple-500","transition-colors","ease-in-out",3,"disabled"],[1,"hidden","md:inline"]],template:function(e,n){if(e&1&&(m(0,"section",0),d(1,_e,2,0,"h2",1),m(2,"form",2),C("ngSubmit",function(){return n.onSubmit()}),m(3,"div",3),g(4,"textarea",4),d(5,ve,3,2,"div",5),r(),m(6,"div",6),d(7,be,2,1,"p"),m(8,"button",7),d(9,xe,1,0)(10,ye,4,1),r()()()()),e&2){let a,p;s("ngClass",n.isReply()?"":"shadow-sm bg-white rounded-lg p-6 my-6"),i(),u(n.isReply()?-1:1),i(),s("formGroup",n.commentForm)("ngClass",n.isReply()?"flex items-start gap-4":""),i(2),J("ngClass",(a=n.commentForm.get("comment"))!=null&&a.invalid&&((a=n.commentForm.get("comment"))!=null&&a.dirty||(a=n.commentForm.get("comment"))!=null&&a.touched)?"border-red":"border-0"),i(),u((p=n.commentForm.get("comment"))!=null&&p.invalid&&((p=n.commentForm.get("comment"))!=null&&p.dirty||(p=n.commentForm.get("comment"))!=null&&p.touched)?5:-1),i(2),u(n.isReply()?-1:7),i(),s("disabled",n.isCommenting()),i(),u(n.isCommenting()?9:10)}},dependencies:[fe,ce,re,ae,le,pe,de,I],encapsulation:2})};function ke(t,o){if(t&1&&(m(0,"span",9),c(1),r()),t&2){let e,n=l();i(),y("@",(e=n.comment())==null?null:e.replyingTo,"")}}function Fe(t,o){if(t&1){let e=x();m(0,"div",8)(1,"app-comment-form",10),C("commentContent",function(a){v(e);let p=l();return b(p.onReply(a))}),r()()}if(t&2){let e=l();i(),s("isCommenting",e.isSendingReply)("isReply",!0)}}var M=class t{comment=_();commentId=_(0);isLastComment=_(!1);replyContent=w();isSendingReply=!1;showCommentForm=!1;onShowCommentForm(){this.showCommentForm=!this.showCommentForm}onReply(o){let e={commentId:this.commentId(),replyingTo:this.comment().user.username,content:o};this.replyContent.emit(e),this.showCommentForm=!1}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-comment"]],inputs:{comment:[1,"comment"],commentId:[1,"commentId"],isLastComment:[1,"isLastComment"]},outputs:{replyContent:"replyContent"},decls:16,vars:8,consts:[[1,"border-b","last:border-b-0","border-gray-200","last:pb-0"],[1,"flex","items-center","justify-between"],[1,"flex","gap-4"],[1,"h-10","w-10","rounded-full",3,"src","alt"],[1,"font-bold","text-dark-800"],[1,"font-semibold","text-blue","cursor-pointer","hover:underline","transition-all","ease-in-out",3,"click"],[1,"ps-0","md:ps-14","mt-3",3,"ngClass"],["class","text-purple font-bold",4,"ngIf"],[1,"ps-0","md:ps-14","mt-3"],[1,"text-purple","font-bold"],[3,"commentContent","isCommenting","isReply"]],template:function(e,n){if(e&1&&(m(0,"div",0)(1,"div",1)(2,"div",2),g(3,"img",3),m(4,"div")(5,"h3",4),c(6),r(),m(7,"p"),c(8),r()()(),m(9,"button",5),C("click",function(){return n.onShowCommentForm()}),c(10," Reply "),r()(),m(11,"div",6)(12,"p"),d(13,ke,2,1,"span",7),c(14),r()(),d(15,Fe,2,2,"div",8),r()),e&2){let a,p,U,P,$,z;i(3),s("src",(a=n.comment())==null||a.user==null?null:a.user.image,Y)("alt",(p=n.comment())==null||p.user==null?null:p.user.name),i(3),T((U=n.comment())==null||U.user==null?null:U.user.name),i(2),y(" @",(P=n.comment())==null||P.user==null?null:P.user.username,""),i(3),s("ngClass",n.isLastComment()?"pb-0":"pb-8"),i(2),s("ngIf",($=n.comment())==null?null:$.replyingTo),i(),y(" ",(z=n.comment())==null?null:z.content," "),i(),u(n.showCommentForm?15:-1)}},dependencies:[I,W,F],encapsulation:2})};var Se=(t,o)=>o==null?null:o.id,we=(t,o)=>o==null?null:o.user;function Te(t,o){if(t&1){let e=x();m(0,"div",5)(1,"app-comment",3),C("replyContent",function(a){v(e);let p=l(4);return b(p.onAddingReply(a))}),r()()}if(t&2){let e=o.$implicit,n=l(2).$implicit;i(),s("comment",e)("commentId",n.id)}}function Ie(t,o){if(t&1&&(m(0,"div",4),q(1,Te,2,2,"div",5,we),r()),t&2){let e=l().$implicit;i(),G(e==null?null:e.replies)}}function Be(t,o){if(t&1){let e=x();m(0,"app-comment",3),C("replyContent",function(a){v(e);let p=l(2);return b(p.onAddingReply(a))}),r(),d(1,Ie,3,0,"div",4)}if(t&2){let e,n=o.$implicit;s("comment",n)("commentId",n.id),i(),u(((e=n==null||n.replies==null?null:n.replies.length)!==null&&e!==void 0?e:0)>0?1:-1)}}function Re(t,o){if(t&1&&(m(0,"section",0)(1,"h2",2),c(2),r(),q(3,Be,2,3,null,null,Se),r()),t&2){let e=l();i(2),y("",e.commentsCount()," Comments"),i(),G(e.comments())}}function Ee(t,o){t&1&&(m(0,"div",1),g(1,"app-empty-card",6),r()),t&2&&(i(),s("title","No comments yet")("showAddButton",!1)("showMessage",!1))}var V=class t{toastrService=f(R);feedBackService=f(E);currentUser=_.required();feedBack=_.required();comments=k(()=>this.feedBack().comments);commentsCount=k(()=>ne(this.feedBack().comments));isSendingReply=!1;onAddingReply(o){let e=this.feedBack();if(!e)return;let n=this.currentUser();if(!n){this.toastrService.error("You must be logged in to reply.");return}this.isSendingReply=!0,this.feedBackService.addReplyToComment(e,o,n).pipe(S(()=>{this.isSendingReply=!1})).subscribe({next:()=>{this.toastrService.success("Reply successfully added!")},error:a=>{this.toastrService.error("Failed to add reply. Please try again later.",`Error ${a.status}`)}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-comment-list"]],inputs:{currentUser:[1,"currentUser"],feedBack:[1,"feedBack"]},decls:2,vars:1,consts:[[1,"rounded","overflow-hidden","shadow-sm","bg-white","p-6","my-8"],[1,"my-10"],[1,"font-bold","text-lg","text-dark-800","mb-8"],[3,"replyContent","comment","commentId"],[1,"mt-8"],[1,"md:ms-6","ps-6"],[3,"title","showAddButton","showMessage"]],template:function(e,n){e&1&&d(0,Re,5,1,"section",0)(1,Ee,2,3,"div",1),e&2&&u(n.commentsCount()>0?0:1)},dependencies:[M,D],encapsulation:2})};function De(t,o){if(t&1){let e=x();m(0,"div")(1,"button",3),C("click",function(){v(e);let a=l();return b(a.onEdit())}),c(2," Edit "),m(3,"span",4),c(4,"Feedback"),r()()()}}var A=class t{location=f(Q);router=f(B);feedBack=_.required();onEdit(){this.router.navigate(["/feedback-form",this.feedBack().id])}goBack(){window.history.length>1?this.location.back():this.router.navigate(["/feedbacks"])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-details-toolbar"]],inputs:{feedBack:[1,"feedBack"]},decls:6,vars:1,consts:[[1,"flex","justify-between","items-center","mb-10"],[1,"text-sm","flex","items-center","gap-3","cursor-pointer","transition","hover:font-bold","hover:underline",3,"click"],["loading","lazy","src","./assets/shared/icon-blue-arrow-left.svg","alt","arrow left"],["type","button","aria-label","Go to edit feedback Page",1,"bg-blue","text-white","px-6","py-3","rounded-xl","font-bold","hover:bg-blue-800","hover:text-light-500","transition","ease-in-out",3,"click"],[1,"hidden","md:inline-block"]],template:function(e,n){e&1&&(m(0,"section",0)(1,"button",1),C("click",function(){return n.goBack()}),g(2,"img",2),m(3,"span"),c(4,"Go Back"),r()(),d(5,De,5,0,"div"),r()),e&2&&(i(5),u(n.feedBack()?5:-1))},encapsulation:2})};function Ne(t,o){if(t&1&&g(0,"app-loading",1),t&2){let e=l();s("fullScreen",!0)("isLoading",e.isFetchingSelectedFeedBack())}}function Le(t,o){if(t&1){let e=x();g(0,"app-details-toolbar",3)(1,"app-feedback-card",3)(2,"app-comment-list",4),m(3,"app-comment-form",5),C("commentContent",function(a){v(e);let p=l(2);return b(p.onComment(a))}),r()}if(t&2){let e=l(2);s("feedBack",e.feedBack()),i(),s("feedBack",e.feedBack()),i(),s("currentUser",e.currentUser())("feedBack",e.feedBack()),i(),s("isCommenting",e.isAddingComment())("isReply",!1)}}function Me(t,o){t&1&&g(0,"app-empty-card",2),t&2&&s("title","No Feedback Found")("showAddButton",!0)("showMessage",!0)}function Ve(t,o){if(t&1&&d(0,Le,4,6)(1,Me,1,3,"app-empty-card",2),t&2){let e=l();u(e.feedBack()?0:1)}}var Ce=class t{activatedRoute=f(X);authService=f(me);feedbackService=f(E);router=f(B);toastrService=f(R);id=0;feedBack=this.feedbackService.selectedFeedBack;isFetchingSelectedFeedBack=this.feedbackService.isFetchingSelectedFeedBack;isAddingComment=O(!1);currentUser=this.authService.user;comments=k(()=>this.feedBack().comments?this.feedBack().comments:[]);paramMap=ee(this.activatedRoute.paramMap,{initialValue:null});constructor(){K(()=>{let o=this.paramMap()?.get("id");if(o){let e=+o;e&&this.feedbackService.getFeedBackById(e)}else this.toastrService.error("Feedback ID is missing in the route parameters."),this.router.navigate(["/feedbacks"])})}onComment(o){let e=this.currentUser();if(!e){this.toastrService.error("You must be logged in to comment.");return}this.isAddingComment.set(!0),this.feedbackService.addComment(this.feedBack(),e,o).pipe(S(()=>this.isAddingComment.set(!1))).subscribe({next:()=>{this.toastrService.success("Comment added successfully.")},error:()=>{this.toastrService.error("Failed to add comment. Please try again later.")}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-feedback-details"]],decls:3,vars:1,consts:[[1,"max-w-3xl","mx-auto","px-6","py-6","md:py-14","lg:py-20"],[3,"fullScreen","isLoading"],[3,"title","showAddButton","showMessage"],[3,"feedBack"],[3,"currentUser","feedBack"],[3,"commentContent","isCommenting","isReply"]],template:function(e,n){e&1&&(m(0,"div",0),d(1,Ne,1,2,"app-loading",1)(2,Ve,2,1),r()),e&2&&(i(),u(n.isFetchingSelectedFeedBack()?1:2))},dependencies:[te,ie,A,oe,F,V,D],encapsulation:2})};export{Ce as FeedbackDetailsComponent};
