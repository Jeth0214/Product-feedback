import{a as me}from"./chunk-JBY4YGPD.js";import{a as ne,b as oe}from"./chunk-VCW76XKX.js";import{a as re,b as G,c as ae,d as le,e as se,f as ce,g as pe,h as de,i as ue,j as fe}from"./chunk-AP2WV5ZC.js";import{f as ee,g as te}from"./chunk-MKXX6BQC.js";import{a as X,b as Z,c as E,d as ie}from"./chunk-EARPDIJI.js";import{a as R}from"./chunk-LQ5RAU3C.js";import{c as K,d as w,e as Q,s as W,u as B}from"./chunk-YYOQC6EH.js";import"./chunk-W4BNGQYG.js";import{Cb as Y,D as S,Hb as s,Ib as T,Jb as y,Ka as O,Oa as i,U as d,Vb as k,Wb as J,Za as v,aa as b,ba as h,bb as u,fa as z,hb as p,la as I,ma as _,mb as f,oa as H,ob as P,pb as q,qb as m,rb as r,sb as g,vb as x,yb as C,zb as l}from"./chunk-E3XBZEU6.js";function _e(t,o){t&1&&(m(0,"h2",1),s(1,"Add Comment"),r())}function ge(t,o){t&1&&(m(0,"div"),s(1,"Comment is required."),r())}function ve(t,o){if(t&1&&(m(0,"div"),s(1),r()),t&2){let e=l(2);i(),y("Comment cannot exceed ",e.maxCharacters," characters.")}}function be(t,o){if(t&1&&(m(0,"div",5),u(1,ge,2,0,"div")(2,ve,2,1,"div"),r()),t&2){let e,n,a=l();i(),f(!((e=a.commentForm.get("comment"))==null||e.errors==null)&&e.errors.required?1:-1),i(),f(!((n=a.commentForm.get("comment"))==null||n.errors==null)&&n.errors.maxlength?2:-1)}}function he(t,o){if(t&1&&(m(0,"p"),s(1),r()),t&2){let e=l();i(),y("",e.remainingCharacters," Characters left")}}var F=class t{fb=d(ue);destroyRef$=d(z);maxCharacters=250;remainingCharacters=this.maxCharacters;isReply=_.required();isCommenting=_.required();buttonText=k(()=>this.isReply()?"Reply":"Comment");commentContent=I();commentForm=new se({});ngOnInit(){this.commentForm=this.fb.group({comment:["",[G.required,G.maxLength(this.maxCharacters)]]}),this.commentForm.get("comment")?.valueChanges.pipe(X(this.destroyRef$)).subscribe(o=>{let e=o?.length||0;this.remainingCharacters=Math.max(0,this.maxCharacters-e)})}onSubmit(){if(this.commentForm.invalid)return;let o=this.commentForm.value.comment.trim();this.commentContent.emit(o),this.commentForm.reset(),this.remainingCharacters=250}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-comment-form"]],inputs:{isReply:[1,"isReply"],isCommenting:[1,"isCommenting"]},outputs:{commentContent:"commentContent"},decls:13,vars:9,consts:[[3,"ngClass"],[1,"font-bold","text-lg","text-dark-800","mb-6"],[3,"ngSubmit","formGroup","ngClass"],[1,"mb-4","flex-1"],["formControlName","comment","placeholder","Type your comment here",1,"min-h-10","w-full","resize-none","rounded","bg-light-500","placeholder:text-dark-500","text-dark-800","text-sm","p-4","px-6","focus:border-blue",3,"ngClass"],[1,"text-red","text-sm"],[1,"flex","justify-between","items-center"],["type","submit",1,"flex","items-center","gap-1","bg-purple","rounded-10","font-bold","text-sm","text-light-500","py-3","px-6","hover:bg-purple-500","transition-colors","ease-in-out",3,"disabled"],[1,"hidden","md:inline"]],template:function(e,n){if(e&1&&(m(0,"section",0),u(1,_e,2,0,"h2",1),m(2,"form",2),C("ngSubmit",function(){return n.onSubmit()}),m(3,"div",3),g(4,"textarea",4),u(5,be,3,2,"div",5),r(),m(6,"div",6),u(7,he,2,1,"p"),m(8,"button",7)(9,"span",8),s(10,"Post"),r(),m(11,"span"),s(12),r()()()()()),e&2){let a,c;p("ngClass",n.isReply()?"":"shadow-sm bg-white rounded-lg p-6 my-6"),i(),f(n.isReply()?-1:1),i(),p("formGroup",n.commentForm)("ngClass",n.isReply()?"flex items-start gap-4":""),i(2),Y("ngClass",(a=n.commentForm.get("comment"))!=null&&a.invalid&&((a=n.commentForm.get("comment"))!=null&&a.dirty||(a=n.commentForm.get("comment"))!=null&&a.touched)?"border-red":"border-0"),i(),f((c=n.commentForm.get("comment"))!=null&&c.invalid&&((c=n.commentForm.get("comment"))!=null&&c.dirty||(c=n.commentForm.get("comment"))!=null&&c.touched)?5:-1),i(2),f(n.isReply()?-1:7),i(),p("disabled",n.isCommenting()),i(4),T(n.buttonText())}},dependencies:[fe,ce,re,ae,le,pe,de,w],encapsulation:2})};function xe(t,o){if(t&1&&(m(0,"span",9),s(1),r()),t&2){let e,n=l();i(),y("@",(e=n.comment())==null?null:e.replyingTo,"")}}function ye(t,o){if(t&1){let e=x();m(0,"div",8)(1,"app-comment-form",10),C("commentContent",function(a){b(e);let c=l();return h(c.onReply(a))}),r()()}if(t&2){let e=l();i(),p("isCommenting",e.isSendingReply)("isReply",!0)}}var L=class t{comment=_();commentId=_(0);isLastComment=_(!1);replyContent=I();isSendingReply=!1;showCommentForm=!1;onShowCommentForm(){this.showCommentForm=!this.showCommentForm}onReply(o){let e={commentId:this.commentId(),replyingTo:this.comment().user.username,content:o};this.replyContent.emit(e),this.showCommentForm=!1}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-comment"]],inputs:{comment:[1,"comment"],commentId:[1,"commentId"],isLastComment:[1,"isLastComment"]},outputs:{replyContent:"replyContent"},decls:16,vars:8,consts:[[1,"border-b","last:border-b-0","border-gray-200","last:pb-0"],[1,"flex","items-center","justify-between"],[1,"flex","gap-4"],[1,"h-10","w-10","rounded-full",3,"src","alt"],[1,"font-bold","text-dark-800"],[1,"font-semibold","text-blue","cursor-pointer","hover:underline","transition-all","ease-in-out",3,"click"],[1,"ps-0","md:ps-14","mt-3",3,"ngClass"],["class","text-purple font-bold",4,"ngIf"],[1,"ps-0","md:ps-14","mt-3"],[1,"text-purple","font-bold"],[3,"commentContent","isCommenting","isReply"]],template:function(e,n){if(e&1&&(m(0,"div",0)(1,"div",1)(2,"div",2),g(3,"img",3),m(4,"div")(5,"h3",4),s(6),r(),m(7,"p"),s(8),r()()(),m(9,"button",5),C("click",function(){return n.onShowCommentForm()}),s(10," Reply "),r()(),m(11,"div",6)(12,"p"),u(13,xe,2,1,"span",7),s(14),r()(),u(15,ye,2,2,"div",8),r()),e&2){let a,c,U,A,j,$;i(3),p("src",(a=n.comment())==null||a.user==null?null:a.user.image,O)("alt",(c=n.comment())==null||c.user==null?null:c.user.name),i(3),T((U=n.comment())==null||U.user==null?null:U.user.name),i(2),y(" @",(A=n.comment())==null||A.user==null?null:A.user.username,""),i(3),p("ngClass",n.isLastComment()?"pb-0":"pb-8"),i(2),p("ngIf",(j=n.comment())==null?null:j.replyingTo),i(),y(" ",($=n.comment())==null?null:$.content," "),i(),f(n.showCommentForm?15:-1)}},dependencies:[w,Q,F],encapsulation:2})};var ke=(t,o)=>o==null?null:o.id,Fe=(t,o)=>o==null?null:o.user;function Se(t,o){if(t&1){let e=x();m(0,"div",5)(1,"app-comment",3),C("replyContent",function(a){b(e);let c=l(3);return h(c.onAddingReply(a))}),r()()}if(t&2){let e=o.$implicit,n=l(2).$implicit;i(),p("comment",e)("commentId",n.id)}}function Ie(t,o){if(t&1&&(m(0,"div",4),P(1,Se,2,2,"div",5,Fe),r()),t&2){let e=l().$implicit;i(),q(e==null?null:e.replies)}}function Te(t,o){if(t&1){let e=x();m(0,"h2",2),s(1),r(),m(2,"app-comment",3),C("replyContent",function(a){b(e);let c=l();return h(c.onAddingReply(a))}),r(),u(3,Ie,3,0,"div",4)}if(t&2){let e,n=o.$implicit,a=l();i(),y("",a.commentsCount()," Comments"),i(),p("comment",n)("commentId",n.id),i(),f(((e=n==null||n.replies==null?null:n.replies.length)!==null&&e!==void 0?e:0)>0?3:-1)}}function we(t,o){t&1&&(m(0,"div",1),g(1,"img",6),m(2,"h3",7),s(3,"No Comment"),r()())}var V=class t{toastrService=d(R);feedBackService=d(E);currentUser=_.required();feedBack=_.required();comments=k(()=>this.feedBack().comments);commentsCount=k(()=>ne(this.feedBack().comments));isSendingReply=!1;onAddingReply(o){let e=this.feedBack();if(!e)return;let n=this.currentUser();if(!n){this.toastrService.error("You must be logged in to reply.");return}this.isSendingReply=!0,this.feedBackService.addReplyToComment(e,o,n).pipe(S(()=>{this.isSendingReply=!1})).subscribe({next:()=>{this.toastrService.success("Reply successfully added!")},error:a=>{this.toastrService.error("Failed to add reply. Please try again later.",`Error ${a.status}`)}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-comment-list"]],inputs:{currentUser:[1,"currentUser"],feedBack:[1,"feedBack"]},decls:4,vars:1,consts:[[1,"rounded","overflow-hidden","shadow-sm","bg-white","p-6","my-8"],[1,"my-10"],[1,"font-bold","text-lg","text-dark-800","mb-8"],[3,"replyContent","comment","commentId"],[1,"mt-8"],[1,"md:ms-6","ps-6"],["src","./assets/suggestions/illustration-empty.svg","alt","Man with magnifying glass",1,"mx-auto","mb-6"],[1,"font-bold","text-3xl","text-center"]],template:function(e,n){e&1&&(m(0,"section",0),P(1,Te,4,4,null,null,ke,!1,we,4,0,"div",1),r()),e&2&&(i(),q(n.comments()))},dependencies:[L],encapsulation:2})};function Be(t,o){if(t&1){let e=x();m(0,"div")(1,"button",3),C("click",function(){b(e);let a=l();return h(a.onEdit())}),s(2," Edit "),m(3,"span",4),s(4,"Feedback"),r()()()}}var M=class t{location=d(K);router=d(B);feedBack=_.required();onEdit(){this.router.navigate(["/feedback-form",this.feedBack().id])}goBack(){window.history.length>1?this.location.back():this.router.navigate(["/feedbacks"])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-details-toolbar"]],inputs:{feedBack:[1,"feedBack"]},decls:6,vars:1,consts:[[1,"flex","justify-between","items-center","mb-10"],[1,"text-sm","flex","items-center","gap-3","cursor-pointer","transition","hover:font-bold","hover:underline",3,"click"],["loading","lazy","src","./assets/shared/icon-blue-arrow-left.svg","alt","arrow left"],["type","button","aria-label","Go to edit feedback Page",1,"bg-blue","text-white","px-6","py-3","rounded-xl","font-bold","hover:bg-blue-800","hover:text-light-500","transition","ease-in-out",3,"click"],[1,"hidden","md:inline-block"]],template:function(e,n){e&1&&(m(0,"section",0)(1,"button",1),C("click",function(){return n.goBack()}),g(2,"img",2),m(3,"span"),s(4,"Go Back"),r()(),u(5,Be,5,0,"div"),r()),e&2&&(i(5),f(n.feedBack()?5:-1))},encapsulation:2})};function Re(t,o){if(t&1&&g(0,"app-loading",1),t&2){let e=l();p("fullScreen",!0)("isLoading",e.isFetchingSelectedFeedBack())}}function Ee(t,o){if(t&1){let e=x();g(0,"app-details-toolbar",2)(1,"app-feedback-card",2)(2,"app-comment-list",3),m(3,"app-comment-form",4),C("commentContent",function(a){b(e);let c=l(2);return h(c.onComment(a))}),r()}if(t&2){let e=l(2);p("feedBack",e.feedBack()),i(),p("feedBack",e.feedBack()),i(),p("currentUser",e.currentUser())("feedBack",e.feedBack()),i(),p("isCommenting",e.isAddingComment())("isReply",!1)}}function De(t,o){t&1&&g(0,"app-empty-card")}function Ne(t,o){if(t&1&&u(0,Ee,4,6)(1,De,1,0,"app-empty-card"),t&2){let e=l();f(e.feedBack()?0:1)}}var Ce=class t{activatedRoute=d(W);authService=d(me);feedbackService=d(E);router=d(B);toastrService=d(R);id=0;feedBack=this.feedbackService.selectedFeedBack;isFetchingSelectedFeedBack=this.feedbackService.isFetchingSelectedFeedBack;isAddingComment=H(!1);currentUser=this.authService.user;comments=k(()=>this.feedBack().comments?this.feedBack().comments:[]);paramMap=Z(this.activatedRoute.paramMap,{initialValue:null});constructor(){J(()=>{let o=this.paramMap()?.get("id");if(o){let e=+o;e&&this.feedbackService.getFeedBackById(e)}else this.toastrService.error("Feedback ID is missing in the route parameters."),this.router.navigate(["/feedbacks"])})}onComment(o){let e=this.currentUser();if(!e){this.toastrService.error("You must be logged in to comment.");return}this.isAddingComment.set(!0),this.feedbackService.addComment(this.feedBack(),e,o).pipe(S(()=>this.isAddingComment.set(!1))).subscribe({next:()=>{this.toastrService.success("Comment added successfully.")},error:()=>{this.toastrService.error("Failed to add comment. Please try again later.")}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=v({type:t,selectors:[["app-feedback-details"]],decls:3,vars:1,consts:[[1,"max-w-3xl","mx-auto","px-6","py-6","md:py-14","lg:py-20"],[3,"fullScreen","isLoading"],[3,"feedBack"],[3,"currentUser","feedBack"],[3,"commentContent","isCommenting","isReply"]],template:function(e,n){e&1&&(m(0,"div",0),u(1,Re,1,2,"app-loading",1)(2,Ne,2,1),r()),e&2&&(i(),f(n.isFetchingSelectedFeedBack()?1:2))},dependencies:[ee,ie,M,oe,F,V,te],encapsulation:2})};export{Ce as FeedbackDetailsComponent};
