import{c as M,k as $}from"./chunk-X6QY3NVG.js";import{e as L,o as U}from"./chunk-2OCL7C4P.js";import{D as b,Hb as T,K as w,L as f,M as v,O as C,Oa as S,U as d,Ub as g,Za as x,_ as y,a as u,b as m,bb as R,fa as p,g as I,hb as B,ma as F,mb as D,oa as a,qb as j,rb as E,z as h,zb as O}from"./chunk-BJCTUVIL.js";function k(s){s||(y(k),s=d(p));let e=new I(t=>s.onDestroy(t.next.bind(t)));return t=>t.pipe(w(e))}function _(s,e){let t=!e?.manualCleanup;t&&!e?.injector&&y(_);let o=t?e?.injector?.get(p)??d(p):null,r=P(e?.equal),n;e?.requireSync?n=a({kind:0},{equal:r}):n=a({kind:1,value:e?.initialValue},{equal:r});let c,l=s.subscribe({next:i=>n.set({kind:1,value:i}),error:i=>{if(e?.rejectErrors)throw i;n.set({kind:2,error:i})},complete:()=>{c?.()}});if(e?.requireSync&&n().kind===0)throw new v(601,!1);return c=o?.onDestroy(l.unsubscribe.bind(l)),g(()=>{let i=n();switch(i.kind){case 1:return i.value;case 2:throw i.error;case 0:throw new v(601,!1)}},{equal:e?.equal})}function P(s=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&s(e.value,t.value)}var q=class s{api="api/feedBacks";http=d(U);destroy$=d(p);toastrService=d($);router=d(M);feedBacks=a([]);selectedFeedBack=a({});categoryTerm=a("All");sortValue=a("Most Upvotes");isFetchingFeedBacks=a(!1);isFetchingSelectedFeedBack=a(!1);isUpVotingFeedback=a(!1);filteredFeedBacks=g(()=>{let e=this.categoryTerm()==="All"?this.feedBacks():this.feedBacks().filter(t=>t.category.toLowerCase()===this.categoryTerm().toLowerCase());return this.sortFeedBacks(this.sortValue(),e)});getAllFeedBacks(){this.isFetchingFeedBacks.set(!0),this.http.get(this.api).pipe(f(e=>this.feedBacks.set(e)),b(()=>this.isFetchingFeedBacks.set(!1)),h(e=>(this.toastrService.error("Error Fetching Feedbacks",`Status: ${e.status}`),[])),k(this.destroy$)).subscribe()}getFeedBackById(e){this.isFetchingSelectedFeedBack.set(!0),this.http.get(`${this.api}/${e}`).pipe(f(t=>this.selectedFeedBack.set(t)),b(()=>this.isFetchingSelectedFeedBack.set(!1)),h(t=>(this.toastrService.error("Error Fetching Feedback",`Status: ${t.status}`),this.router.navigate(["/"]),[])),k(this.destroy$)).subscribe()}addFeedBack(e){return this.http.post(this.api,e)}updateFeedBack(e){return this.http.put(this.api,e).pipe(f(()=>{this.selectedFeedBack.set(u(u({},this.selectedFeedBack()),e))}))}addComment(e,t,o){let r=e.comments??[],c={id:r.length>0?r[r.length-1].id+1:1,user:t,content:o},l=m(u({},e),{comments:[...r,c]});return this.updateFeedBack(l)}addReplyToComment(e,t,o){let r=[...e.comments??[]],n=r.find(i=>i.id===t.commentId),c={content:t.content,replyingTo:t.replyingTo,user:o},l=m(u({},e),{comments:r.map(i=>i.id===t.commentId?m(u({},i),{replies:[...i.replies||[],c]}):i)});return this.updateFeedBack(l)}saveFeedBack(e,t){return t?this.updateFeedBack(e):this.addFeedBack(e)}upVoteFeedBack(e){this.isUpVotingFeedback.set(!0),this.http.put(this.api,e).pipe(f(()=>{this.feedBacks.update(t=>t.map(o=>o.id===e.id?e:o)),this.selectedFeedBack.set(e)}),b(()=>this.isUpVotingFeedback.set(!1)),h(t=>(this.toastrService.error("Failed to upvote feedback",`Status: ${t.status}`),[]))).subscribe()}deleteFeedBack(e){return this.http.delete(`${this.api}/${e}`)}setCategoryTerm(e){this.categoryTerm.set(e)}setSortValue(e){this.sortValue.set(e)}sortFeedBacks(e,t){let o=r=>r.comments?.reduce((n,c)=>n+1+(c.replies?.length||0),0)||0;switch(e){case"Most Upvotes":return[...t].sort((r,n)=>n.upvotes-r.upvotes);case"Least Upvotes":return[...t].sort((r,n)=>r.upvotes-n.upvotes);case"Most Comments":return[...t].sort((r,n)=>o(n)-o(r));case"Least Comments":return[...t].sort((r,n)=>o(r)-o(n));default:return t}}static \u0275fac=function(t){return new(t||s)};static \u0275prov=C({token:s,factory:s.\u0275fac,providedIn:"root"})};function H(s,e){if(s&1&&(j(0,"div",0)(1,"div")(2,"div",1)(3,"span",2),T(4,"Loading..."),E()()()()),s&2){let t=O();B("ngClass",t.fullScreen()?"p-6 my-5 h-screen grid place-items-center text-center":""),S(2),B("ngClass",t.fullScreen()?"h-10 w-10 border-4":"h-3 w-3 border-2")}}var V=class s{isLoading=F(!1);fullScreen=F(!1);static \u0275fac=function(t){return new(t||s)};static \u0275cmp=x({type:s,selectors:[["app-loading"]],inputs:{isLoading:[1,"isLoading"],fullScreen:[1,"fullScreen"]},decls:1,vars:1,consts:[[3,"ngClass"],["role","status",1,"inline-block","animate-spin","rounded-full","border-solid","border-current","border-e-transparent","align-[-0.125em]","text-surface","motion-reduce:animate-[spin_1.5s_linear_infinite]",3,"ngClass"],[1,"!absolute","!-m-px","!h-px","!w-px","!overflow-hidden","!whitespace-nowrap","!border-0","!p-0","![clip:rect(0,0,0,0)]"]],template:function(t,o){t&1&&R(0,H,5,2,"div",0),t&2&&D(o.isLoading()?0:-1)},dependencies:[L],encapsulation:2})};export{k as a,_ as b,q as c,V as d};
