import{a as G}from"./chunk-52N2FHJW.js";import{a as z,b as k,c as q,d as H,e as $,f as X,g as J,h as K,i as Q,j as W}from"./chunk-UX4HVCSM.js";import{a as B,b as R,c as A,d as j}from"./chunk-KSXUJNXY.js";import{a as O,c as P,k as N}from"./chunk-X6QY3NVG.js";import{d as M,e as L}from"./chunk-2OCL7C4P.js";import"./chunk-W4BNGQYG.js";import{D as w,Hb as l,Jb as S,Ka as I,Oa as r,U as u,Ub as v,Vb as y,Za as V,a as _,aa as C,b as D,ba as F,bb as f,fa as U,hb as d,mb as c,oa as b,qb as n,rb as a,sb as h,vb as x,yb as g,zb as p}from"./chunk-BJCTUVIL.js";var T=(m=>(m.Feature="Feature",m.UI="UI",m.UX="UX",m.Enhancement="Enhancement",m.Bug="Bug",m))(T||{});var E=(s=>(s.Suggestion="Suggestion",s.Planned="Planned",s.InProgress="In-Progress",s.Live="Live",s))(E||{});function Z(o,e){o&1&&(n(0,"small",18),l(1,"Can't be empty"),a())}function ee(o,e){o&1&&(n(0,"small",18),l(1,"Must be at least 5 characters"),a())}function te(o,e){if(o&1&&f(0,Z,2,0,"small",18)(1,ee,2,0,"small",18),o&2){let t,i,s=p();c(!((t=s.feedBackform.get("title"))==null||t.errors==null)&&t.errors.required?0:-1),r(),c(!((i=s.feedBackform.get("title"))==null||i.errors==null)&&i.errors.minlength?1:-1)}}function ie(o,e){if(o&1){let t=x();n(0,"div",8)(1,"h2"),l(2,"Category"),a(),n(3,"label",19),l(4,"Choose a category for your feedback"),a(),n(5,"app-dropdown",20),g("processOption",function(s){C(t);let m=p();return F(m.onSelectCategory(s))}),a()()}if(o&2){let t=p();r(5),d("defaultOption",t.selectedCategory())("dropDownOptions",t.categories)("dropDownType","block")("dropDownArrowColor","blue")}}function oe(o,e){if(o&1){let t=x();n(0,"div",8)(1,"h2"),l(2,"Update Status"),a(),n(3,"label",21),l(4,"Change feature state"),a(),n(5,"app-dropdown",20),g("processOption",function(s){C(t);let m=p();return F(m.onSelectStatus(s))}),a()()}if(o&2){let t=p();r(5),d("defaultOption",t.selectedStatus())("dropDownOptions",t.statuses)("dropDownType","block")("dropDownArrowColor","blue")}}function ne(o,e){o&1&&(n(0,"small",18),l(1,"Can't be empty"),a())}function re(o,e){o&1&&(n(0,"small",18),l(1,"Must be at least 5 characters"),a())}function ae(o,e){if(o&1&&f(0,ne,2,0,"small",18)(1,re,2,0,"small",18),o&2){let t,i,s=p();c(!((t=s.feedBackform.get("description"))==null||t.errors==null)&&t.errors.required?0:-1),r(),c(!((i=s.feedBackform.get("description"))==null||i.errors==null)&&i.errors.minlength?1:-1)}}function se(o,e){if(o&1){let t=x();n(0,"div",14)(1,"button",22),g("click",function(){C(t);let s=p();return F(s.deleteFeedBack())}),l(2),a()()}if(o&2){let t=p();r(),d("disabled",t.isDeleting()||t.isSaving()),r(),S(" ",t.deleteButtonText()," ")}}var Y=class o{activatedRoute=u(O);formBuilder=u(Q);feedbackService=u(A);toastrService=u(N);router=u(P);destroyRef=u(U);location=u(M);selectedFeedBack=this.feedbackService.selectedFeedBack;isFetchingFeedBack=this.feedbackService.isFetchingSelectedFeedBack;isSaving=b(!1);isDeleting=b(!1);id=b(0);feedBackform=new $({});categories=Object.keys(T);statuses=Object.values(E);selectedCategory=b(this.dropdownValueToTitleCase(this.categories[0]));selectedStatus=b("");idParam=R(this.activatedRoute.paramMap);isUpdateMode=v(()=>!!this.selectedFeedBack()&&!!this.id());title=v(()=>this.isUpdateMode()?`Editing '${this.selectedFeedBack().title}'`:"Create New Feedback");formIcon=v(()=>this.isUpdateMode()?"assets/shared/icon-edit-feedback.svg":"assets/shared/icon-new-feedback.svg");deleteButtonText=v(()=>this.isDeleting()?"Deleting...":"Delete");saveButtonText=v(()=>this.isSaving()?"Saving...":this.isUpdateMode()?" Update Feedback":"Add Feedback");constructor(){y(()=>{let e=+(this.idParam()?.get("id")??0);e&&(this.id.set(e),this.feedbackService.getFeedBackById(this.id()))}),y(()=>{let e=this.selectedFeedBack();this.initializeForm(e,this.id())})}initializeForm(e,t){e&&t?(this.setUpForm(e),this.selectedCategory.set(this.dropdownValueToTitleCase(e.category)),this.selectedStatus.set(this.dropdownValueToTitleCase(e.status))):(this.selectedCategory.set(this.dropdownValueToTitleCase(this.categories[0])),this.setUpForm())}setUpForm(e){this.feedBackform=this.formBuilder.group({title:[e?.title??"",[k.required,k.minLength(5)]],description:[e?.description??"",[k.required,k.minLength(5)]]})}hasError(e){let t=this.feedBackform.get(e);return!!(t&&t.invalid&&t.touched)}onSelectCategory(e){this.selectedCategory.set(e.toLowerCase())}onSelectStatus(e){this.selectedStatus.set(e.toLowerCase())}onSubmit(){if(this.feedBackform.invalid)return;let e=this.setPayload();this.saveFeedBack(e)}setPayload(){let e=this.isUpdateMode()?this.selectedFeedBack():{upvotes:0,comments:[]},t=this.feedBackform.value;return _(D(_(_({},e),t),{category:this.selectedCategory().toLowerCase()}),this.isUpdateMode()?{status:this.selectedStatus().toLowerCase()}:{})}saveFeedBack(e){this.isSaving.set(!0),this.feedbackService.saveFeedBack(e,this.isUpdateMode()).pipe(w(()=>{this.isSaving.set(!1)}),B(this.destroyRef)).subscribe({next:()=>{this.toastrService.success("Feedback saved successfully","Success"),this.goBack()},error:t=>{this.toastrService.error("Failed to save feedback",`Status: ${t.status}`)}})}deleteFeedBack(){this.isDeleting.set(!0),this.feedbackService.deleteFeedBack(this.id()).pipe(w(()=>{this.isDeleting.set(!1)}),B(this.destroyRef)).subscribe({next:()=>{this.toastrService.success("Feedback deleted successfully","Success"),this.router.navigate(["/feedbacks"])},error:e=>{this.toastrService.error("Failed to delete feedback",`Status: ${e.status}`)}})}goBack(){window.history.length>1?this.location.back():this.router.navigate(["/feedbacks"])}dropdownValueToTitleCase(e){return e?e.includes("-")?e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join("-"):e.charAt(0).toUpperCase()+e.slice(1):""}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=V({type:o,selectors:[["app-feedback-form"]],decls:36,vars:18,consts:[[1,"max-w-xl","mx-auto","my-6","md:my-10","px-6"],[3,"fullScreen","isLoading"],[1,"text-sm","flex","items-center","gap-3","cursor-pointer","transition","font-bold","hover:underline",3,"click"],["loading","lazy","src","./assets/shared/icon-blue-arrow-left.svg","alt","arrow left"],[1,"bg-white","rounded-lg","p-5","md:p-10","mt-12","md:mt-20"],["alt","form icon","loading","lazy",1,"-mt-12","md:-mt-16",3,"src"],[1,"text-2xl","mt-3"],[1,"mt-10",3,"ngSubmit","formGroup"],[1,"mt-10"],["for","title",1,"text-sm","text-dark-500"],["type","text","id","title","formControlName","title",1,"w-full","mt-4","py-3","px-6","text-dark-800","bg-light-800","rounded-lg","border",3,"disabled","ngClass"],["for","description",1,"text-sm","text-dark-500"],["id","description","formControlName","description","rows","5",1,"w-full","mt-4","py-3","px-6","text-dark-800","bg-light-800","rounded-lg","border",3,"disabled","ngClass"],[1,"mt-10","flex","flex-wrap","gap-3","font-bold","md:flex-nowrap","md:items-start",3,"ngClass"],[1,"w-full","md:w-auto","order-3","md:order-1"],[1,"w-full","md:w-auto","flex","flex-col-reverse","md:flex-row","gap-3","md:gap-3","order-2","md:order-2"],["type","button",1,"w-full","md:w-auto","py-3","px-6","bg-dark-800","text-light-800","rounded-lg","hover:bg-dark-500","transition",3,"click","disabled"],["type","submit",1,"w-full","md:w-auto","py-3","px-6","bg-purple","text-white","rounded-lg","hover:bg-purple-500","transition",3,"disabled"],[1,"text-red","text-sm","mt-3"],["for","category",1,"text-sm","text-dark-500"],[3,"processOption","defaultOption","dropDownOptions","dropDownType","dropDownArrowColor"],["for","status",1,"text-sm","text-dark-500"],["type","button",1,"w-full","py-3","px-6","bg-red","text-light-800","rounded-lg","hover:bg-red-500","transition",3,"click","disabled"]],template:function(t,i){t&1&&(n(0,"main",0),h(1,"app-loading",1),n(2,"div")(3,"button",2),g("click",function(){return i.goBack()}),h(4,"img",3),n(5,"span"),l(6,"Go Back"),a()()(),n(7,"div",4)(8,"div"),h(9,"img",5),n(10,"h1",6),l(11),a()(),n(12,"form",7),g("ngSubmit",function(){return i.onSubmit()}),n(13,"div",8)(14,"h2"),l(15,"Feedback Title"),a(),n(16,"label",9),l(17,"Add a short, descriptive headline"),a(),h(18,"input",10),f(19,te,2,2),a(),f(20,ie,6,4,"div",8)(21,oe,6,4,"div",8),n(22,"div",8)(23,"h2"),l(24,"Feedback Detail"),a(),n(25,"label",11),l(26,"Include any specific comments on what should be improved, added, etc."),a(),h(27,"textarea",12),f(28,ae,2,2),a(),n(29,"div",13),f(30,se,3,2,"div",14),n(31,"div",15)(32,"button",16),g("click",function(){return i.goBack()}),l(33," Cancel "),a(),n(34,"button",17),l(35),a()()()()()()),t&2&&(r(),d("fullScreen",!0)("isLoading",i.isFetchingFeedBack()),r(8),d("src",i.formIcon(),I),r(2),S(" ",i.title()," "),r(),d("formGroup",i.feedBackform),r(6),d("disabled",i.isSaving()||i.isDeleting())("ngClass",i.hasError("title")?"border-red":"border-white focus:outline-none focus:border-blue focus:ring-1 focus:ring-blue hover:border-blue hover:ring-1 hover:ring-blue"),r(),c(i.hasError("title")?19:-1),r(),c(i.selectedCategory()?20:-1),r(),c(i.isUpdateMode()?21:-1),r(6),d("disabled",i.isSaving()||i.isDeleting())("ngClass",i.hasError("description")?"border-red":"border-white focus:outline-none focus:border-blue focus:ring-1 focus:ring-blue hover:border-blue hover:ring-1 hover:ring-blue"),r(),c(i.hasError("description")?28:-1),r(),d("ngClass",i.isUpdateMode()?"md:justify-between":"md:justify-end"),r(),c(i.isUpdateMode()?30:-1),r(2),d("disabled",i.isSaving()||i.isDeleting()),r(2),d("disabled",i.feedBackform.invalid||i.isSaving()||i.isDeleting()),r(),S(" ",i.saveButtonText()," "))},dependencies:[G,W,X,z,q,H,J,K,L,j],encapsulation:2})};export{Y as FeedbackFormComponent};
